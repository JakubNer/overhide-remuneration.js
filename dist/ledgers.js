!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("web3")):"function"==typeof define&&define.amd?define("__oh$__",["web3"],t):"object"==typeof exports?exports.__oh$__=t(require("web3")):e.__oh$__=t(e.Web3)}(window,function(e){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(t,r){t.exports=e},function(e,t,r){"use strict";r.r(t),function(e){var n=r(0),a=r.n(n);function o(e,t,r,n,a,o,s){try{var u=e[o](s),i=u.value}catch(e){return void r(e)}u.done?t(i):Promise.resolve(i).then(n,a)}function s(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var s=e.apply(t,r);function u(e){o(s,n,a,u,i,"next",e)}function i(e){o(s,n,a,u,i,"throw",e)}u(void 0)})}}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function i(e){var t="function"==typeof Map?new Map:void 0;return(i=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return c(e,arguments,l(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),d(n,e)})(e)}function c(e,t,r){return(c=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var a=new(Function.bind.apply(e,n));return r&&d(a,r.prototype),a}).apply(null,arguments)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function E(e){return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var f=function(){var t="object"==("undefined"==typeof self?"undefined":E(self))&&self.self===self&&self||"object"==(void 0===e?"undefined":E(e))&&e.global===e&&e||this||{};t.oh$=new(function(e){function t(){var e,r,n,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,s=new Array(o),i=0;i<o;i++)s[i]=arguments[i];return n=this,r=!(a=(e=l(t)).call.apply(e,[this].concat(s)))||"object"!==E(a)&&"function"!=typeof a?u(n):a,p(u(r),"enable",g),p(u(r),"getImparterTags",G),p(u(r),"canSetCredentials",y),p(u(r),"canGenerateCredentials",k),p(u(r),"canChangeNetwork",x),p(u(r),"generateCredentials",M),p(u(r),"setCredentials",v),p(u(r),"setNetwork",O),p(u(r),"getOverhideRemunerationAPIUri",B),p(u(r),"getCredentials",I),p(u(r),"getNetwork",L),p(u(r),"getFromDollars",W),p(u(r),"getTallyDollars",C),p(u(r),"getTally",N),p(u(r),"getTransactions",$),p(u(r),"isOnLedger",K),p(u(r),"sign",X),p(u(r),"createTransaction",V),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,i(EventTarget)),t}());var r=500,n="eth-web3",o="ohledger",c="ohledger-web3",_=null,w=new Promise(function(e){return _=e}),R=null,h=null,m=[o],T={ETH_WEB3_IMPARTER_TAG:{walletAddress:null,network:null,remuneration_uri:{main:"https://ethereum.overhide.io",rinkeby:"https://rinkeby.ethereum.overhide.io"}},OHLEDGER_IMPARTER_TAG:{oh_ledger_transact_fn:{prod:null,test:null},address:null,secret:null,mode:"test",remuneration_uri:{prod:"https://ledger.overhide.io/v1",test:"https://test.ledger.overhide.io/v1"}},OHLEDGER_WEB3_IMPARTER_TAG:{oh_ledger_transact_fn:{prod:null,test:null},walletAddress:null,mode:"test",remuneration_uri:{prod:"https://ledger.overhide.io/v1",test:"https://test.ledger.overhide.io/v1"}}},A=new a.a("http://localhost:8545").eth.accounts;function b(e,t){var r=document.createEvent("Event");for(var n in r.initEvent(e,!0,!0),t)r[n]=t[n];f.dispatchEvent(r)}function g(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{fetcher:fetch}).fetcher;R=e,h=t,_(!0)}function G(){return m}function y(e){return e===o}function k(e){return e===o}function x(e){switch(e){case o:case c:return!0;default:return!1}}function v(e,t){return P.apply(this,arguments)}function P(){return(P=s(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next=e.t0===o?3:17;break;case 3:if("secret"in r){e.next=5;break}throw new Error("'secret' must be passed in");case 5:if("address"in r&&r.address?T.OHLEDGER_IMPARTER_TAG.address=r.address.toLowerCase():T.OHLEDGER_IMPARTER_TAG.address=A.privateKeyToAccount(r.secret).address.toLowerCase(),T.OHLEDGER_IMPARTER_TAG.secret=r.secret,e.prev=7,A.recover(A.sign("test message",T.OHLEDGER_IMPARTER_TAG.secret)).toLowerCase()==T.OHLEDGER_IMPARTER_TAG.address){e.next=10;break}throw new Error("'secret' not valid for 'address");case 10:e.next=15;break;case 12:throw e.prev=12,e.t1=e.catch(7),new Error("'secret' not valid for 'address");case 15:return b("onCredentialsUpdate",{imparterTag:o,address:T.OHLEDGER_IMPARTER_TAG.address,secret:T.OHLEDGER_IMPARTER_TAG.secret}),e.abrupt("return",!0);case 17:return e.abrupt("return",!1);case 18:case"end":return e.stop()}},e,null,[[7,12]])}))).apply(this,arguments)}function I(e){switch(e){case o:return{address:T.OHLEDGER_IMPARTER_TAG.address,secret:T.OHLEDGER_IMPARTER_TAG.secret};case c:return{address:T.OHLEDGER_WEB3_IMPARTER_TAG.walletAddress};case n:return{address:T.ETH_WEB3_IMPARTER_TAG.walletAddress};default:throw new Error("invalid imparterTag")}}function M(e,t){return H.apply(this,arguments)}function H(){return(H=s(regeneratorRuntime.mark(function e(t,r){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next=e.t0===o?3:8;break;case 3:return n=A.create(),T.OHLEDGER_IMPARTER_TAG.address=n.address.toLowerCase(),T.OHLEDGER_IMPARTER_TAG.secret=n.privateKey,b("onCredentialsUpdate",{imparterTag:o,address:T.OHLEDGER_IMPARTER_TAG.address,secret:T.OHLEDGER_IMPARTER_TAG.secret}),e.abrupt("return",!0);case 8:return e.abrupt("return",!1);case 9:case"end":return e.stop()}},e)}))).apply(this,arguments)}function O(e,t){return D.apply(this,arguments)}function D(){return(D=s(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n!=t){e.next=2;break}return e.abrupt("return",!1);case 2:if("currency"in r){e.next=4;break}throw new Error("'currency' must be passed in");case 4:if("mode"in r){e.next=6;break}throw new Error("'mode' must be passed in");case 6:if(r.currency=r.currency.toUpperCase(),r.mode=r.mode.toLowerCase(),"USD"===r.currency){e.next=10;break}throw new Error("'currency' must be 'USD'");case 10:if("prod"===r.mode||"test"===r.mode){e.next=12;break}throw new Error("'mode' must be 'prod' or 'test'");case 12:e.t0=t,e.next=e.t0===o?15:e.t0===c?18:21;break;case 15:return T.OHLEDGER_IMPARTER_TAG.mode=r.mode,b("onNetworkChange",{imparterTag:o,currency:"USD",mode:r.mode,uri:T.OHLEDGER_IMPARTER_TAG.remuneration_uri[r.mode]}),e.abrupt("return",!0);case 18:return T.OHLEDGER_WEB3_IMPARTER_TAG.mode=r.mode,b("onNetworkChange",{imparterTag:c,currency:"USD",mode:r.mode,uri:T.OHLEDGER_WEB3_IMPARTER_TAG.remuneration_uri[r.mode]}),e.abrupt("return",!0);case 21:return e.abrupt("return",!1);case 22:case"end":return e.stop()}},e)}))).apply(this,arguments)}function L(e){switch(e){case o:return{currency:"USD",mode:T.OHLEDGER_WEB3_IMPARTER_TAG.mode,uri:T.OHLEDGER_WEB3_IMPARTER_TAG.remuneration_uri[T.OHLEDGER_WEB3_IMPARTER_TAG.mode]};case c:return{currency:"USD",mode:T.OHLEDGER_IMPARTER_TAG.mode,uri:T.OHLEDGER_IMPARTER_TAG.remuneration_uri[T.OHLEDGER_IMPARTER_TAG.mode]};case n:return{name:T.ETH_WEB3_IMPARTER_TAG.network,uri:T.ETH_WEB3_IMPARTER_TAG.remuneration_uri[T.ETH_WEB3_IMPARTER_TAG.network]};default:throw new Error("invalid imparterTag")}}function B(e){switch(e){case o:if(!T.OHLEDGER_IMPARTER_TAG.mode)throw new Error("network 'mode' must be set, use setNetwork");return T.OHLEDGER_IMPARTER_TAG.remuneration_uri[T.OHLEDGER_IMPARTER_TAG.mode];case c:if(!T.OHLEDGER_WEB3_IMPARTER_TAG.mode)throw new Error("network 'mode' must be set, use setNetwork");return T.OHLEDGER_WEB3_IMPARTER_TAG.remuneration_uri[T.OHLEDGER_WEB3_IMPARTER_TAG.mode];case n:return T.ETH_WEB3_IMPARTER_TAG.remuneration_uri[T.ETH_WEB3_IMPARTER_TAG.network];default:return null}}function W(e,t){return S.apply(this,arguments)}function S(){return(S=s(regeneratorRuntime.mark(function e(t,r){var a,s,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next=e.t0===o?3:e.t0===c?3:e.t0===n?4:19;break;case 3:return e.abrupt("return",100*r);case 4:return a="main"===T.ETH_WEB3_IMPARTER_TAG.network?"":"test.",s=(new Date).toISOString(),e.next=8,w;case 8:if(e.t1=e.sent,!e.t1){e.next=11;break}e.t1=!h;case 11:if(!e.t1){e.next=13;break}throw new Error("did you forget to `oh$.enable(..)`?");case 13:return e.next=15,h("https://".concat(a,"rates.overhide.io/rates/eth/").concat(s),{headers:new Headers({Authorization:"Bearer ".concat(R)})}).then(function(e){return e.json()}).catch(function(e){throw String(e)});case 15:if((u=e.sent)&&!(!1 in u)&&0!==u.minrate){e.next=18;break}return e.abrupt("return",0);case 18:return e.abrupt("return",r/u.minrate);case 19:return e.abrupt("return",null);case 20:case"end":return e.stop()}},e)}))).apply(this,arguments)}function C(e,t,r){return j.apply(this,arguments)}function j(){return(j=s(regeneratorRuntime.mark(function e(t,r,a){var s,u,i,d;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next=e.t0===o?3:e.t0===c?3:e.t0===n?7:26;break;case 3:return e.next=5,N(t,r,a);case 5:return s=e.sent,e.abrupt("return",(s/100).toFixed(2));case 7:return e.next=9,$(t,r,a);case 9:if((u=e.sent)&&0!=u.length){e.next=12;break}return e.abrupt("return",0);case 12:return i=u.map(function(e){return"".concat(e["transaction-value"],"@").concat(new Date(e["transaction-date"]).toISOString())}),d="main"===T.ETH_WEB3_IMPARTER_TAG.network?"":"test.",(new Date).toISOString(),e.next=17,w;case 17:if(e.t1=e.sent,!e.t1){e.next=20;break}e.t1=!h;case 20:if(!e.t1){e.next=22;break}throw new Error("did you forget to `oh$.enable(..)`?");case 22:return e.next=24,h("https://".concat(d,"rates.overhide.io/tallymax/wei/").concat(i.join(",")),{headers:new Headers({Authorization:"Bearer ".concat(R)})}).then(function(e){return e.text()}).catch(function(e){throw String(e)});case 24:return s=e.sent,e.abrupt("return",(Math.round(100*s)/100).toFixed(2));case 26:return e.abrupt("return",null);case 27:case"end":return e.stop()}},e)}))).apply(this,arguments)}function N(e,t,r){return U.apply(this,arguments)}function U(){return(U=s(regeneratorRuntime.mark(function e(t,r,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,q(t,r,n,!0);case 2:return e.abrupt("return",e.sent.tally);case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}function $(e,t,r){return F.apply(this,arguments)}function F(){return(F=s(regeneratorRuntime.mark(function e(t,r,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,q(t,r,n,!1);case 2:return e.abrupt("return",e.sent.transactions);case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}function q(e,t,r,n){return z.apply(this,arguments)}function z(){return(z=s(regeneratorRuntime.mark(function e(t,r,a,s){var u,i,d,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!a||a instanceof Date){e.next=2;break}throw new Error("'date' must be a Date is passed in");case 2:if("address"in r&&r.address){e.next=4;break}throw new Error("'address' required in recipient");case 4:u=r.address,i=B(t),e.t0=t,e.next=e.t0===o?9:e.t0===c?15:e.t0===n?21:27;break;case 9:if(T.OHLEDGER_IMPARTER_TAG.mode){e.next=11;break}throw new Error("network 'mode' must be set, use setNetwork");case 11:if(T.OHLEDGER_IMPARTER_TAG.address){e.next=13;break}throw new Error("from 'address' not set: use setCredentials");case 13:return d=T.OHLEDGER_IMPARTER_TAG.address,e.abrupt("break",28);case 15:if(T.OHLEDGER_WEB3_IMPARTER_TAG.mode){e.next=17;break}throw new Error("network 'mode' must be set, use setNetwork");case 17:if(T.OHLEDGER_WEB3_IMPARTER_TAG.walletAddress){e.next=19;break}throw new Error("from 'walletAddress' not set: use wallet");case 19:return d=T.OHLEDGER_WEB3_IMPARTER_TAG.walletAddress,e.abrupt("break",28);case 21:if(T.ETH_WEB3_IMPARTER_TAG.network){e.next=23;break}throw new Error("no network for imparter tag");case 23:if(T.ETH_WEB3_IMPARTER_TAG.walletAddress){e.next=25;break}throw new Error("from 'walletAddress' not set: use wallet");case 25:return d=T.ETH_WEB3_IMPARTER_TAG.walletAddress,e.abrupt("break",28);case 27:throw new Error("unsupported imparter tag");case 28:if(i){e.next=30;break}throw new Error("no uri for request, unsupported network selected in wallet?");case 30:return l="",a&&(l="&since=".concat(a.toISOString())),e.next=34,w;case 34:if(e.t1=e.sent,!e.t1){e.next=37;break}e.t1=!h;case 37:if(!e.t1){e.next=39;break}throw new Error("did you forget to `oh$.enable(..)`?");case 39:return e.next=41,h("".concat(i,"/get-transactions/").concat(d,"/").concat(u,"?tally-only=").concat(s?"true":"false").concat(l),{headers:new Headers({Authorization:"Bearer ".concat(R)})}).then(function(e){return e.json()}).catch(function(e){throw String(e)});case 41:return e.abrupt("return",e.sent);case 42:case"end":return e.stop()}},e)}))).apply(this,arguments)}function K(e){return J.apply(this,arguments)}function J(){return(J=s(regeneratorRuntime.mark(function e(t){var r,a,s,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=B(t),e.t0=t,e.next=e.t0===o?4:e.t0===c?10:e.t0===n?16:22;break;case 4:if(T.OHLEDGER_IMPARTER_TAG.mode){e.next=6;break}throw new Error("network 'mode' must be set, use setNetwork");case 6:if(T.OHLEDGER_IMPARTER_TAG.address){e.next=8;break}throw new Error("from 'address' not set: use setCredentials");case 8:return a=T.OHLEDGER_IMPARTER_TAG.address,e.abrupt("break",23);case 10:if(T.OHLEDGER_WEB3_IMPARTER_TAG.mode){e.next=12;break}throw new Error("network 'mode' must be set, use setNetwork");case 12:if(T.OHLEDGER_WEB3_IMPARTER_TAG.walletAddress){e.next=14;break}throw new Error("from 'walletAddress' not set: use wallet");case 14:return a=T.OHLEDGER_WEB3_IMPARTER_TAG.walletAddress,e.abrupt("break",23);case 16:if(T.ETH_WEB3_IMPARTER_TAG.network){e.next=18;break}throw new Error("no network for imparter tag");case 18:if(T.ETH_WEB3_IMPARTER_TAG.walletAddress){e.next=20;break}throw new Error("from 'walletAddress' not set: use wallet");case 20:return a=T.ETH_WEB3_IMPARTER_TAG.walletAddress,e.abrupt("break",23);case 22:throw new Error("unsupported imparter tag");case 23:if(r){e.next=25;break}throw new Error("no uri for request, unsupported network selected in wallet?");case 25:return s="verify ownership of address by signing",e.next=28,X(t,s);case 28:return u=e.sent,e.next=31,w;case 31:if(e.t1=e.sent,!e.t1){e.next=34;break}e.t1=!h;case 34:if(!e.t1){e.next=36;break}throw new Error("did you forget to `oh$.enable(..)`?");case 36:return e.next=38,h("".concat(r,"/is-signature-valid"),{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8",Authorization:"Bearer ".concat(R)},body:JSON.stringify({signature:btoa(u),message:btoa(s),address:a})}).then(function(e){return 200==e.status}).catch(function(e){throw String(e)});case 38:return e.abrupt("return",e.sent);case 39:case"end":return e.stop()}},e)}))).apply(this,arguments)}function X(e,t){return Q.apply(this,arguments)}function Q(){return(Q=s(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next=e.t0===o?3:e.t0===c?6:e.t0===n?12:18;break;case 3:if(T.OHLEDGER_IMPARTER_TAG.secret){e.next=5;break}throw new Error("credentials for imparter ".concat(o," not set"));case 5:return e.abrupt("return",A.sign(r,T.OHLEDGER_IMPARTER_TAG.secret).signature);case 6:if(T.OHLEDGER_WEB3_IMPARTER_TAG.walletAddress){e.next=8;break}throw new Error("imparter ".concat(c," not active"));case 8:return b("onWalletPopup",{imparterTag:c}),e.next=11,window.web3.eth.personal.sign(r,T.OHLEDGER_WEB3_IMPARTER_TAG.walletAddress,"");case 11:return e.abrupt("return",e.sent);case 12:if(T.ETH_WEB3_IMPARTER_TAG.walletAddress){e.next=14;break}throw new Error("imparter ".concat(n," not active"));case 14:return b("onWalletPopup",{imparterTag:n}),e.next=17,window.web3.eth.personal.sign(r,T.ETH_WEB3_IMPARTER_TAG.walletAddress,"");case 17:return e.abrupt("return",e.sent);case 18:return e.abrupt("return",null);case 19:case"end":return e.stop()}},e)}))).apply(this,arguments)}function V(e,t,r,n){return Y.apply(this,arguments)}function Y(){return(Y=s(regeneratorRuntime.mark(function e(t,r,a,s){var u,i,d,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next=e.t0===o?3:e.t0===c?9:e.t0===n?15:21;break;case 3:if(T.OHLEDGER_IMPARTER_TAG.mode){e.next=5;break}throw new Error("network 'mode' must be set, use setNetwork");case 5:if(T.OHLEDGER_IMPARTER_TAG.address){e.next=7;break}throw new Error("from 'address' not set: use setCredentials");case 7:return u=T.OHLEDGER_IMPARTER_TAG.address,e.abrupt("break",22);case 9:if(T.OHLEDGER_WEB3_IMPARTER_TAG.mode){e.next=11;break}throw new Error("network 'mode' must be set, use setNetwork");case 11:if(T.OHLEDGER_WEB3_IMPARTER_TAG.walletAddress){e.next=13;break}throw new Error("from 'walletAddress' not set: use wallet");case 13:return u=T.OHLEDGER_WEB3_IMPARTER_TAG.walletAddress,e.abrupt("break",22);case 15:if(T.ETH_WEB3_IMPARTER_TAG.network){e.next=17;break}throw new Error("no network for imparter tag");case 17:if(T.ETH_WEB3_IMPARTER_TAG.walletAddress){e.next=19;break}throw new Error("from 'walletAddress' not set: use wallet");case 19:return u=T.ETH_WEB3_IMPARTER_TAG.walletAddress,e.abrupt("break",22);case 21:throw new Error("unsupported imparter tag");case 22:e.t1=t,e.next=e.t1===o?25:e.t1===c?25:e.t1===n?44:48;break;case 25:if(0!=r){e.next=39;break}if(!("message"in s&&s.message&&"signature"in s&&s.signature)){e.next=31;break}i=s.message,d=s.signature,e.next=35;break;case 31:return i="verify ownership of address by signing on ".concat((new Date).toLocaleString()),e.next=34,X(t,i);case 34:d=e.sent;case 35:return e.next=37,ae(t,u,d,i);case 37:e.next=43;break;case 39:return l=te(),T.OHLEDGER_IMPARTER_TAG.oh_ledger_transact_fn[T.OHLEDGER_IMPARTER_TAG.mode](r,u,a),e.next=43,l;case 43:return e.abrupt("break",49);case 44:return b("onWalletPopup",{imparterTag:n}),e.next=47,new Promise(function(e,t){web3.eth.sendTransaction({from:u,to:a,value:r}).on("confirmation",function(t,r){e()}).on("error",function(e){t(e)})});case 47:return e.abrupt("break",49);case 48:throw new Error("unsupported imparter tag");case 49:return e.abrupt("return",!0);case 50:case"end":return e.stop()}},e)}))).apply(this,arguments)}!function(){var e=document.createElement("div");e.setAttribute("id","oh-popup-container"),e.style.display="none",e.innerHTML='\n      <div>\n        <a href="#" title="Close" id="oh-popup-close" onclick="window.parent.document.dispatchEvent(new CustomEvent(\'oh$-popup-close\',{})); return false;">X</a>\n        <iframe id="oh-ledger-gratis-iframe"></iframe>\n      </div>\n    ';var t=document.createElement("style");t.innerHTML='\n      #oh-popup-container {\n          position: fixed;\n          font-family: arial, "lucida console", sans-serif;\n          top: 0;\n          right: 0;\n          bottom: 0;\n          left: 0;\n          background: rgba(0, 0, 0, 0.8);\n          z-index: 999;\n          opacity:1;\n          pointer-events: auto;\n      }\n      #oh-popup-container > div {\n          width: 80vw;\n          height: 75vh;\n          position: relative;\n          top: 15vh;\n          margin: auto auto;\n          padding: 5px 5px 5px 5px;\n          background: white;\n      }\n      #oh-popup-close {\n          background: grey;\n          color: white;\n          line-height: 25px;\n          position: absolute;\n          right: 2px;\n          text-align: center;\n          top: 2px;\n          width: 24px;\n          text-decoration: none;\n          font-weight: bold;\n      }\n      #oh-popup-close:hover {\n          background: black;\n      }\n\n      #oh-ledger-gratis-iframe {\n        display: none;\n        border: 0;\n        overflow: hidden;\n        width: 100%;\n        height: 100%;\n      }\n    ',function r(){document.body?(document.body.appendChild(e),document.body.appendChild(t),se("".concat(T.OHLEDGER_IMPARTER_TAG.remuneration_uri.prod,"/transact.js"),function(){T.OHLEDGER_IMPARTER_TAG.oh_ledger_transact_fn.prod=oh_ledger_transact,T.OHLEDGER_WEB3_IMPARTER_TAG.oh_ledger_transact_fn.prod=oh_ledger_transact},document.body),se("".concat(T.OHLEDGER_IMPARTER_TAG.remuneration_uri.test,"/transact.js"),function(){T.OHLEDGER_IMPARTER_TAG.oh_ledger_transact_fn.test=oh_ledger_transact,T.OHLEDGER_WEB3_IMPARTER_TAG.oh_ledger_transact_fn.test=oh_ledger_transact},document.body)):setTimeout(r,100)}()}(),function(){if(!window.ethereum)return;s(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,window.ethereum.enable();case 3:window.web3=new a.a(window.ethereum),t.next=8;break;case 6:t.prev=6,t.t0=t.catch(0);case 8:return t.next=10,e();case 10:setInterval(s(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e();case 2:case"end":return t.stop()}},t)})),r);case 11:case"end":return t.stop()}},t,null,[[0,6]])}))();var e=(t=s(regeneratorRuntime.mark(function e(){var t,r,a,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,window.web3.eth.getAccounts();case 3:return t=e.sent,r=t&&t.length>0?t[0]:null,e.next=7,window.web3.eth.net.getNetworkType();case 7:a=e.sent,e.next=12;break;case 10:e.prev=10,e.t0=e.catch(0);case 12:a!==T.ETH_WEB3_IMPARTER_TAG.network&&(T.ETH_WEB3_IMPARTER_TAG.network=a,b("onNetworkChange",{imparterTag:n,name:a,uri:T.ETH_WEB3_IMPARTER_TAG.remuneration_uri[a]})),r!==T.ETH_WEB3_IMPARTER_TAG.walletAddress&&(r?(-1==m.findIndex(function(e){return e===n})&&m.push(n),-1==m.findIndex(function(e){return e===c})&&m.push(c)):((o=m.findIndex(function(e){return e===n}))>-1&&m.splice(o,1),(o=m.findIndex(function(e){return e===c}))>-1&&m.splice(o,1)),T.ETH_WEB3_IMPARTER_TAG.walletAddress=r,T.OHLEDGER_WEB3_IMPARTER_TAG.walletAddress=r,b("onWalletChange",{imparterTag:n,isPresent:!!r}),b("onWalletChange",{imparterTag:c,isPresent:!!r}),r&&(b("onCredentialsUpdate",{imparterTag:n,address:r}),b("onCredentialsUpdate",{imparterTag:c,address:r})));case 14:case"end":return e.stop()}},e,null,[[0,10]])})),function(){return t.apply(this,arguments)});var t}();var Z=null,ee=null;function te(){return console.assert(!Z,"oh-popup promise being set but already set when calling setupNewPromise(..)"),new Promise(function(e,t){Z=e,ee=t})}function re(e,t){var r=document.getElementById("oh-popup-container");ne(),r.style.display="none",console.assert(Z,"oh-popup promise not set yet calling makePopupHidden(..)"),t?ee(e):Z(e),Z=null,ee=null}function ne(){document.getElementById("oh-ledger-gratis-iframe").style.display="none"}function ae(e,t,r,n){return oe.apply(this,arguments)}function oe(){return(oe=s(regeneratorRuntime.mark(function e(t,r,n,a){var o,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return ne(),o=B(t),(s=document.getElementById("oh-ledger-gratis-iframe")).setAttribute("src","".concat(o,"/gratis.html?address=").concat(r,"&signature=").concat(n,"&message=").concat(a)),s.style.display="block",e.next=7,document.getElementById("oh-popup-container").style.display="block",te();case 7:case"end":return e.stop()}},e)}))).apply(this,arguments)}function se(e,t,r){var n=document.createElement("script");n.src=e,n.onload=t,n.onreadystatechange=t,r.appendChild(n)}return window.addEventListener("message",function(e){e.data&&"oh-ledger-ok"===e.data.event?re(e.data.detail):e.data&&"oh-ledger-error"===e.data.event&&re(e.data.detail,!0)},!1),window.document.addEventListener("oh$-popup-close",function(e){re("user close",!0)}),t.oh$}();t.default=f}.call(this,r(2))},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r}])});
//# sourceMappingURL=ledgers.js.map